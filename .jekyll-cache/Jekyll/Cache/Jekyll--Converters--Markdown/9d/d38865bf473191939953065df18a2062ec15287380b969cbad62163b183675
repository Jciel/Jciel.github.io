I"ﬂ)<p><br />
<br /></p>

<p>Lambda functions, closures, partials functions, curryng, s√£o conceitos
e t√©cnicas existentes h√° muito tempo na √°rea de ci√™ncia da computa√ß√£o,
principalmente no estudo do paradigma de desenvolvimento funcional.
Muitos destes conceitos vem sendo adotado por linguagens a priori
orientada a objetos, no PHP n√£o √© diferente, j√° a algum tempo podemos
implementar v√°rias destas t√©cnicas.</p>

<p><img src="https://cdn-images-1.medium.com/max/2000/1*oT0-Tqda8sGMdKH0SHPbOw.jpeg" alt="" /></p>
<div class="img-legend">Nate Grant em Unsplash</div>

<p><br /></p>

<p>Desde a vers√£o 5.3 o PHP tem suporte a lambda functions e tamb√©m
tem suporte a First-Class Functions e High-Order Functions.
First-Class Functions permite tratar uma fun√ß√£o como qualquer
outro valor, atribu√≠-la a uma vari√°vel, pass√°-la como par√¢metro,
etc. High-Order Functions significa que uma fun√ß√£o pode receber
outra fun√ß√£o como argumento e/ou retornar uma fun√ß√£o como resultado.
Algumas fun√ß√µes desse tipo que j√° existem no core do PHP e que s√£o
bastante utilizadas s√£o por exemplo: array_map, array_reduce,
fun√ß√µes de ordena√ß√£o: usort, uksort.</p>

<div id="ref-post">
    <a href="/2018/A-vida-com-menos-loops-em-PHP/">
        <img src="http://i64.tinypic.com/11gn987.jpg" />
        <div id="link-title">
            A vida com menos loops em PHP
        </div>
        <div id="link-description">
            O array √© umas das estruturas de dados mais conhecidas e
            utilizadas em PHP, um array √© na verdade um mapa ordenado,
            uma‚Ä¶
        </div>
    </a>
</div>

<p><br /></p>

<p>Isso nos permite implementar algumas t√©cnicas de programa√ß√£o
funcional e criar c√≥digos mais expressivos, f√°ceis de ler e dar
manuten√ß√£o. Tamb√©m possibilita uma maior reutiliza√ß√£o de c√≥digos,
agilizando o desenvolvimento e deixando o projeto mais consistente.
Vamos ver como funciona e como podemos implementar essas t√©cnicas.</p>

<p><br />
<br /></p>

<h4 id="lambda-functionsfun√ß√µes-an√¥nimas"><strong>Lambda functions/Fun√ß√µes an√¥nimas</strong></h4>
<p>Fun√ß√µes an√¥nimas simplesmente permite a cria√ß√£o de uma fun√ß√£o sem
nome espec√≠fico, podendo ser atribu√≠da a uma vari√°vel, passada
como argumento para uma fun√ß√£o ou como retorno de uma fun√ß√£o.</p>

<script src="https://gist.github.com/Jciel/7ccb4cee9cb89f43018b06d1b5373093.js"></script>

<p>No primeiro exemplo criamos uma fun√ß√£o an√¥nima que recebe dois
par√¢metros e atribu√≠mos a vari√°vel <code class="language-plaintext highlighter-rouge">$sum</code>, assim chamamos como uma
fun√ß√£o normalmente. No segundo exemplo criamos uma fun√ß√£o nomeada
<code class="language-plaintext highlighter-rouge">soma</code> que recebe um callback(fun√ß√£o) como primeiro par√¢metro e mais
dois n√∫meros como par√¢metros, ao chamar essa fun√ß√£o passamos como
callback a fun√ß√£o an√¥nima <code class="language-plaintext highlighter-rouge">$sum</code>, dentro dessa fun√ß√£o executamos o
callback passando os dois n√∫meros restantes.</p>

<p><br />
<br /></p>

<h4 id="closures"><strong>Closures</strong></h4>
<p>Uma Closure √© semelhante a uma fun√ß√£o an√¥nima, a diferen√ßa esta no
fato de que uma Closure tem acesso a vari√°veis do escopo externo.
Para isso o PHP possui a palavra-chave <code class="language-plaintext highlighter-rouge">use</code>, possibilitando passar
qualquer vari√°vel do escopo externo para dentro da fun√ß√£o.</p>

<script src="https://gist.github.com/Jciel/b9c079958b07f9d46ea888acbc152d15.js"></script>

<p>No primeiro exemplo criamos uma fun√ß√£o an√¥nima comum tentando
acessar uma vari√°vel do escopo externo, ao tentar executar a
fun√ß√£o temos um ‚ÄúPHP Notice‚Äù dizendo que a vari√°vel <code class="language-plaintext highlighter-rouge">$name</code> dentro
da fun√ß√£o n√£o existe. Na segunda fun√ß√£o usamos o <code class="language-plaintext highlighter-rouge">use</code> para passar
a var√°vel <code class="language-plaintext highlighter-rouge">$name</code> para dentro da fun√ß√£o, assim temos acesso a ela ao
chamarmos a fun√ß√£o.</p>

<p><br /></p>

<p>Lambda functions/Closures s√£o instancia da classe Closure, esta
classe possui alguns m√©todos.</p>

<p><strong>Closure::call</strong></p>

<p>Vincula a Closure <strong>temporariamente</strong> a um objeto/escopo e a chama com
qualquer par√¢metro passado.</p>

<script src="https://gist.github.com/Jciel/2df45cf796819a0d5ec8dca92e53ae05.js"></script>

<p>Na linha 21 e 22 estamos chamando a Closure <code class="language-plaintext highlighter-rouge">$addAge</code> vinculando ao
escopo do objeto <code class="language-plaintext highlighter-rouge">$person1</code> e <code class="language-plaintext highlighter-rouge">$person2</code> respectivamente, e passando o
par√¢metro que ela necessita, ent√£o ela esta executando como se fosse
um m√©todo interno aos respectivos objetos.</p>

<p><strong>Closure::bindTo/Closure::bind</strong></p>

<p>Os m√©todos bindTo/bind retorna uma nova Closure com um objeto e um
escopo vinculado, <strong>n√£o √© tempor√°rio</strong>, assim, se o objeto vinculado for
alterado, o resultado da chamada da nova Closure poder√° ter seu valor
alterado tamb√©m. Clojure::bind √© uma vers√£o <em>static</em> de Closure::bindTo.</p>

<script src="https://gist.github.com/Jciel/d790d398d3fd6ecfb4eb0da3ba337d70.js"></script>

<p>Nesse exemplo estamos usando os m√©todos bindTo e bind(<em>static</em>) para
vincular definitivo a Closure <code class="language-plaintext highlighter-rouge">$addAge</code> nos objetos <code class="language-plaintext highlighter-rouge">$person1</code> e <code class="language-plaintext highlighter-rouge">$person2</code>
respectivamente. Esse m√©todo retorna uma nova Closure que estamos
atribuindo a <code class="language-plaintext highlighter-rouge">$closurePerson1</code> e <code class="language-plaintext highlighter-rouge">$closurePerson2</code>. Aqui podemos perceber
que se alterarmos a propriedade <code class="language-plaintext highlighter-rouge">$age</code> dos objetos e chamarmos
<code class="language-plaintext highlighter-rouge">$closurePerson1</code> e <code class="language-plaintext highlighter-rouge">$closurePerson2</code> novamente o resultado retornado √©
diferente.</p>

<p><strong>Closure::fromCallable</strong></p>

<p>Closure::fromCallable permite converter um Callable(fun√ß√£o) em uma
Closure. Para isso precisamos passar a fun√ß√£o que queremos converter
como par√¢metro para esse m√©todo. Essa fun√ß√£o verifica se o callable
esta no escopo atual, se for do escopo externo vai lan√ßar um erro.</p>

<script src="https://gist.github.com/Jciel/51ec13ab0d8b269d2ac5667acd57efaf.js"></script>

<p><br />
<br /></p>

<h4 id="partial-functions"><strong>Partial functions</strong></h4>
<p>Utilizando Closures podemos criar algo chamando partials functions.
Partials functions s√£o fun√ß√µes que pegam uma fun√ß√£o existente e
reduzem a quantidade de par√¢metros ligando um ou mais de seus
par√¢metros a um valor espec√≠fico, retornando uma outra fun√ß√£o com
esses par√¢metros j√° definidos. As partials functions permite dividir
em fun√ß√µes mais espec√≠ficas e compartilhar a funcionalidade central
de uma fun√ß√£o mais ampla. O objetivo √© poder fixar os argumentos
necess√°rios e retornar outra fun√ß√£o com esses valores definidos, e
assim, na chamada da nova fun√ß√£o, definir apenas os par√¢metros
restantes.</p>

<script src="https://gist.github.com/Jciel/15f802a21d35a3cc41c8dacbed786fc7.js"></script>

<p>No exemplo acima, praticamente criamos um ‚Äúconstrututor‚Äù de fun√ß√µes de
multiplica√ß√£o. Criamos uma fun√ß√£o <code class="language-plaintext highlighter-rouge">makeMultiply</code> que recebe um n√∫mero
como par√¢metro ($x) e retorna uma outra fun√ß√£o, mas j√° fixando um
valor da multiplica√ß√£o como o par√¢metro recebido, assim podemos
construir outras fun√ß√µes mais espec√≠ficas utilizando esta como base.
Por exemplo, se quisermos uma fun√ß√£o que multiplica qualquer n√∫mero
por 2 (linha 11) ou por 5 (linha 12), podemos usa-la para isso.</p>

<p><br /></p>

<p>Podemos criar uma fun√ß√£o generalista que retorna uma partial function
de qualquer outra fun√ß√£o, assim podemos reutiliz√°-la sempre que
necess√°rio.</p>

<script src="https://gist.github.com/Jciel/a042854fe0001f9f4915f9ab13c6a67a.js"></script>

<p><br /></p>

<p>Assim, possibilita criarmos fun√ß√µes generalista e ir criando as
fun√ß√µes mais espec√≠ficas quando necess√°rio, o mesmo exemplo de cima.</p>

<script src="https://gist.github.com/Jciel/2b9bc4b19807823db692d869a682ada4.js"></script>

<p><br />
<br /></p>

<h4 id="currying"><strong>Currying</strong></h4>
<p>Utilizando Closures tamb√©m podemos fazer currying de fun√ß√µes.
Currying √© uma t√©cnica utilizada para transformar uma fun√ß√£o que
recebe m√∫ltiplos par√¢metros em uma cadeia de fun√ß√µes, cada uma lidando
com apenas um par√¢metro da fun√ß√£o inicial. Ap√≥s feito o currying,
uma fun√ß√£o rebe o primeiro par√¢metro e devolve uma fun√ß√£o que aceita
o segundo e assim por diante.</p>

<script src="https://gist.github.com/Jciel/2e8aeb8872d2b184c83ca83c28eb307f.js"></script>

<p>No primeiro exemplo utilizando uma fun√ß√£o comum recebendo tr√™s
par√¢metros, e retornando a soma dos mesmos. No segundo c√≥digo,
utilizando currying, separamos a l√≥gica em tr√™s fun√ß√µes, cada uma
trabalhando com apenas um par√¢metro, assim podemos cham√°-la como
uma sequ√™ncia de fun√ß√µes. Embora se pare√ßa com partials function,
currying e partials functions s√£o conceitos e t√©cnicas diferentes.</p>

<p><br />
<br /></p>

<h4 id="conclus√£o"><strong>Conclus√£o</strong></h4>
<p>Acabamos de ver algumas t√©cnicas utilizando lambda functions/Closure
que auxiliam na resolu√ß√£o de problemas, reusabilidade de c√≥digo e
constru√ß√£o de um c√≥digo mais limpo e expressivo.<br />
<br />
Cada caso deve ser avaliado e estudado qual a melhor t√©cnica para
resolver determinado problema, os recursos est√£o dispon√≠veis,
bastando apenas a aplica√ß√£o da resolu√ß√£o.</p>

<p>Refer√™ncias:<br />
<a href="https://wiki.php.net/rfc/closurefromcallable">https://wiki.php.net/rfc/closurefromcallable</a></p>

<p><a href="https://wiki.php.net/rfc/closure_apply">https://wiki.php.net/rfc/closure_apply</a></p>

<p>Livro <a href="https://medium.com/r/?url=https%3A%2F%2Fwww.amazon.com%2FPHP-Data-Structures-Algorithms-Implement%2Fdp%2F178646389X">PHP 7 Data Structures and Algorithms</a></p>

<p>Livro <a href="https://medium.com/r/?url=https%3A%2F%2Fwww.amazon.com%2FPro-Functional-PHP-Programming-Optimization-ebook%2Fdp%2FB075ZRK5MN%2Fref%3Dsr_1_1%3Fs%3Dbooks%26ie%3DUTF8%26qid%3D1523840834%26sr%3D1-1%26keywords%3DPro%2BFunctional%2BPHP%2BProgramming">Pro Functional PHP Programming</a></p>
:ET